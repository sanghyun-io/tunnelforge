# 스케줄 백업 가이드

TunnelForge의 스케줄 백업 기능을 사용하면 데이터베이스를 자동으로 정기 백업할 수 있습니다.

## 기능 개요

- **Cron 스타일 스케줄링** - 유연한 시간 설정
- **자동 터널 연결** - 백업 시 터널이 자동으로 연결됨
- **보관 정책** - 오래된 백업 자동 정리
- **백업 로그** - 성공/실패 이력 확인

## 시작하기

### 1. 스케줄 관리 열기

메인 툴바에서 **"스케줄"** 버튼을 클릭하거나, 메뉴에서 **도구 → 스케줄 백업**을 선택합니다.

### 2. 새 스케줄 추가

1. **"추가"** 버튼 클릭
2. 설정 입력:
   - **이름**: 스케줄 구분용 (예: "운영DB 일일백업")
   - **터널**: 사용할 터널 선택
   - **스키마**: 백업할 데이터베이스 이름
   - **테이블**: 특정 테이블만 백업 (비워두면 전체)
   - **출력 경로**: 백업 파일 저장 위치
3. 스케줄 시간 설정 (아래 참조)
4. **저장** 클릭

## 스케줄 설정

### 간편 설정

| 타입 | 설명 | 예시 |
|------|------|------|
| **매일** | 매일 지정 시간에 실행 | 매일 03:00 |
| **매주** | 특정 요일에 실행 | 매주 월요일 06:00 |
| **매월** | 매월 특정일에 실행 | 매월 1일 00:00 |

### 고급 설정 (Cron 표현식)

더 세밀한 설정이 필요하면 **고급 설정** 탭에서 Cron 표현식을 직접 입력합니다.

**형식**: `분 시 일 월 요일`

| 필드 | 범위 | 특수문자 |
|------|------|----------|
| 분 | 0-59 | * , - / |
| 시 | 0-23 | * , - / |
| 일 | 1-31 | * , - / |
| 월 | 1-12 | * , - / |
| 요일 | 0-6 (0=일요일) | * , - / |

## Cron 표현식 예시

### 기본 예시

| 표현식 | 설명 |
|--------|------|
| `0 3 * * *` | 매일 03:00 |
| `30 6 * * *` | 매일 06:30 |
| `0 0 * * *` | 매일 자정 |
| `0 12 * * *` | 매일 정오 |

### 요일별 예시

| 표현식 | 설명 |
|--------|------|
| `0 0 * * 0` | 매주 일요일 00:00 |
| `0 6 * * 1` | 매주 월요일 06:00 |
| `0 18 * * 5` | 매주 금요일 18:00 |
| `0 3 * * 1-5` | 평일(월~금) 03:00 |
| `0 2 * * 0,6` | 주말(토,일) 02:00 |

### 날짜별 예시

| 표현식 | 설명 |
|--------|------|
| `0 0 1 * *` | 매월 1일 00:00 |
| `0 3 15 * *` | 매월 15일 03:00 |
| `0 0 1,15 * *` | 매월 1일, 15일 00:00 |

### 간격 예시

| 표현식 | 설명 |
|--------|------|
| `*/30 * * * *` | 30분마다 |
| `0 */2 * * *` | 2시간마다 |
| `0 */6 * * *` | 6시간마다 (00, 06, 12, 18시) |

## 활용 시나리오

### 시나리오 1: 운영 DB 일일 백업

**목적**: 매일 새벽에 운영 데이터베이스 전체 백업

```
이름: 운영DB_일일백업
터널: 운영서버
스키마: production_db
테이블: (전체)
스케줄: 0 3 * * *  (매일 03:00)
보관: 7개, 30일
```

### 시나리오 2: 주요 테이블 시간별 백업

**목적**: 중요 데이터 테이블만 자주 백업

```
이름: 주문데이터_시간별
터널: 운영서버
스키마: ecommerce
테이블: orders, order_items, payments
스케줄: 0 */4 * * *  (4시간마다)
보관: 12개, 7일
```

### 시나리오 3: 개발 DB 주간 스냅샷

**목적**: 개발 환경 주간 백업

```
이름: 개발DB_주간
터널: 개발서버
스키마: dev_db
테이블: (전체)
스케줄: 0 0 * * 1  (매주 월요일 00:00)
보관: 4개, 30일
```

### 시나리오 4: 월말 마감 백업

**목적**: 매월 말 재무 데이터 보관

```
이름: 재무_월말백업
터널: 재무서버
스키마: finance_db
테이블: transactions, ledger, reports
스케줄: 0 23 28 * *  (매월 28일 23:00)
보관: 12개, 365일
```

### 시나리오 5: 평일 업무시간 외 백업

**목적**: 업무에 영향 없이 백업 수행

```
이름: CRM_평일백업
터널: CRM서버
스키마: crm_db
테이블: (전체)
스케줄: 0 22 * * 1-5  (평일 22:00)
보관: 5개, 14일
```

## 보관 정책

스케줄마다 보관 정책을 설정할 수 있습니다:

| 설정 | 설명 | 권장값 |
|------|------|--------|
| **최대 백업 수** | 유지할 백업 개수 | 5-10개 |
| **보관 기간** | 백업 유지 일수 | 7-30일 |

**동작 방식**:
- 새 백업 생성 후 오래된 백업 자동 정리
- 보관 기간이 지나거나, 최대 개수를 초과하면 삭제
- 두 조건 모두 적용 (더 엄격한 조건 우선)

## 백업 파일 구조

백업은 지정한 출력 경로에 다음 형식으로 저장됩니다:

```
출력경로/
├── 스케줄이름_20240115_030000/
│   ├── table1.sql
│   ├── table1.tsv
│   ├── table2.sql
│   ├── table2.tsv
│   └── ...
├── 스케줄이름_20240116_030000/
│   └── ...
└── ...
```

각 백업 폴더는 `{스케줄이름}_{날짜}_{시간}` 형식입니다.

## 백업 로그 확인

스케줄 관리 창의 **"백업 로그"** 탭에서 최근 7일간의 백업 이력을 확인할 수 있습니다.

- ✅ 성공한 백업
- ❌ 실패한 백업 (오류 메시지 포함)

로그 파일 위치: `%LOCALAPPDATA%\TunnelForge\backup_logs\`

## 즉시 실행

스케줄 시간을 기다리지 않고 바로 백업하려면:

1. 스케줄 목록에서 원하는 항목 선택
2. **"즉시 실행"** 버튼 클릭

## 중요 사항

### 앱 실행 필수

> **스케줄이 작동하려면 TunnelForge가 실행 중이어야 합니다.**

| 상태 | 스케줄 작동 |
|------|------------|
| 앱 실행 중 | ✅ 작동 |
| 시스템 트레이로 최소화 | ✅ 작동 |
| 앱 완전 종료 | ❌ **작동 안함** |
| PC 재시작 후 | ❌ 수동 실행 필요 |

**권장**: 시스템 트레이에 최소화하여 상시 실행

### 터널 연결

- 백업 시 터널이 연결되어 있지 않으면 자동으로 연결 시도
- 터널 연결 실패 시 백업도 실패 (로그에 기록)

### 디스크 공간

- 백업 전 충분한 디스크 공간 확보
- 보관 정책을 적절히 설정하여 디스크 부족 방지

### MySQL Shell 필요

Export/Import 기능은 [MySQL Shell](https://dev.mysql.com/downloads/shell/)이 필요합니다.

## 문제 해결

### 백업이 실행되지 않음

1. TunnelForge가 실행 중인지 확인
2. 스케줄이 "활성화" 상태인지 확인
3. 다음 실행 시간이 올바른지 확인

### 백업 실패

1. 백업 로그에서 오류 메시지 확인
2. 터널 연결이 정상인지 확인
3. 출력 경로에 쓰기 권한이 있는지 확인
4. MySQL Shell이 설치되어 있는지 확인

### Cron 표현식 오류

- 필드가 5개인지 확인 (분 시 일 월 요일)
- 각 필드의 값 범위 확인
- 고급 설정 탭에서 "다음 실행" 시간 표시 확인
