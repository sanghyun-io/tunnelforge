#!/usr/bin/env bash
# TunnelDB Manager - Version Bump (Bash Wrapper)

# Check for help flag
if [[ "$1" == "-h" || "$1" == "-Help" || "$1" == "--help" ]]; then
    cat << 'EOF'

TunnelDB Manager - Version Bump

Automatically increment version and optionally create release.

Usage:
  ./scripts/bump-version -Type <patch|minor|major> [-AutoRelease] [-DryRun]

Options:
  -Type <type>     Version bump type (required)
                   - patch: 1.0.0 -> 1.0.1 (bug fixes)
                   - minor: 1.0.0 -> 1.1.0 (new features)
                   - major: 1.0.0 -> 2.0.0 (breaking changes)

  -AutoRelease     Auto commit, push, tag, and trigger GitHub Actions
  -DryRun          Preview without executing
  -h, -Help        Show this help

Examples:
  # Patch version bump + auto release (recommended)
  ./scripts/bump-version -Type patch -AutoRelease

  # Minor version bump (file update only)
  ./scripts/bump-version -Type minor

  # Preview
  ./scripts/bump-version -Type patch -DryRun

EOF
    exit 0
fi

# Convert path to Windows format
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd -W 2>/dev/null || pwd)"
PS_SCRIPT="$SCRIPT_DIR\\bump-version.ps1"
PS_SCRIPT="${PS_SCRIPT//\//\\}"

# Call PowerShell script
powershell.exe -NoProfile -ExecutionPolicy Bypass -Command "
    [Console]::OutputEncoding = [System.Text.Encoding]::UTF8
    & '$PS_SCRIPT' $*
"
